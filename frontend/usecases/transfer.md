# transfer usecases

交易发送有两种模式，合约模式与直接发送模式。
- 在合约模式下，批量转账的请求会被batch为单笔智能合约交易。这种转账方式具备原子性，但转账数目受区块 gas 最大值限制，单次转账中 CFX 大概可以支持数千条（3k上下），erc777类型的token大致可支持数百条（300上下）。同时部分交易所 / 钱包检测转账时无法检测使用这种方式进行的转账。
- 在直接发送模式下，批量转账会通过rpc的batch方法发送，每次发送500条。这种转账方式不具备理论上的原子性，但在前端尽可能地进行了封装处理，在发送出错时也能够通过续发功能保证所有交易都被发送。这种方法没有发送数目的限制，但需要用户提供私钥。用户如果无法确认操作环境的安全性，该操作会存在隐患。

## 发送交易

### 合约模式

0. 已设置账户与csv
1. 点击批量转账
   1. 点击后conflux portal的授权框可能不会立即弹出，但是此时各个按钮已经无法再进行点击，交易状态转为 Preparing，出现“当前交易状态” ui
   2. 点击时如果双击 后一次操作会被忽略
2. 弹出conflux portal 授权框
3. 点击确认
4. 交易状态转为pending，右上角会弹出通知
   1. 交易执行错误会弹出 error 对话框
   2. 关闭对话框后可以点击“当前交易状态”的交易状态tag再次确认错误
5. 交易状态转为 executed，右上角会弹出通知
6. 交易状态转为 confirmed，交易被加入历史交易中，右上角会弹出通知

注：此时“当前交易状态”存在对应变化 此处未进行详细说明

### 直接发送模式


0. 已设置账户与csv
1. 点击批量转账
2. 弹出对话框，告知批量转账模式相关事项
3. 点击“批量转账”
   1. 点击时如果双击 后一次操作会被忽略
4. 交易状态转为preparing，将会构造之后需要发送的交易，需要发送交易较多时这个阶段会比较耗时
   1. 发生错误会弹出 error 对话框，续发按钮不会出现
5. 交易状态转为 pending，右上角会弹出通知
6. 每500笔交易会被打包发出，其中的最后一笔交易被执行后，若当前的batch不是最后的batch，右上角会弹出通知， “500/1000/... 笔交易已被执行”
7. 最后一笔交易状态转为 executed，右上角会弹出通知
8. 交易状态转为 confirmed，交易被加入历史交易中，右上角会弹出通知

注：此时“当前交易状态”存在对应变化 此处未进行详细说明

#### 续发功能

0. 已设置账户与csv
1. 在直接发送模式下进行发送一个大小大于 BATCHLIMIT 的csv，在发送至一半时手动断网
2. 跳出报错后重新连网
3. 点击“续发”
4. 弹出续发对话框，点击续发
5. 在确认之前最后一笔交易已被执行后，交易状态转为preparing，将会构造之后需要发送的交易，需要发送交易较多时这个阶段会比较耗时
   1. 如果之前的交易已发送完毕，将会跳过 6，7 步
6. 交易状态转为 pending，右上角会弹出通知
7. 每500笔交易会被打包发出，其中的最后一笔交易被执行后，若当前的batch不是最后的batch，右上角会弹出通知， “500/1000/... 笔交易已被执行”
   1. 此时显示已经执行的交易数目会包含续发前已发出的数目
8. 最后一笔交易状态转为 executed，右上角会弹出通知
9. 交易状态转为 confirmed，交易被加入历史交易中，右上角会弹出通知

###### 续发按钮的显示

显示条件为存在pendingResults
reset csv 后将无法续发

1.  在直接发送模式下进行发送一个大小大于 BATCHLIMIT 的csv，在发送至一半时手动断网
2.  跳出报错，出现“续发按钮”
3.  点击“reset csv”
4.  再选择新的csv
5.  续发按钮没有出现
